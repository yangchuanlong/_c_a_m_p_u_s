<view class='container'>
    <view class='title'>{{detail.title}}</view>
    <view class='author'>
        <image src='{{detail.avatar}}' class='avatar' wx:if="{{!detail.anonymous}}"></image>
        <image wx:else src="../images/anonymousUserImg.png"   class='avatar'></image>
        <view class='nickName'>{{detail.anonymous ? "匿名" : users[detail.openid].nickName}}</view>
        <view style="flex:1;"></view>
        <text>{{detail.createdTime}}</text>
        <text>阅读量：{{scanCount}}</text>
    </view>
    <view class='content'>
        {{detail.content}}
        <view class="imagesWrapper" wx:if="{{detail.images}}">
            <image wx:for="{{detail.images}}" src="{{item}}" wx:key="{{item}}">{{item}}</image>
        </view>
    </view>
    <view class='comments'>
        <view class='subTitle'>评论区</view>
        <view class='comment-list'>
            <view
                class='replyItem'
                wx:for="{{mainReplies}}"
                wx:key="{{item.id}}"
                data-reply-id="{{item._id}}"
                data-author="{{item.openid}}"
                bindtap="onMainReplyClick"
            >
                <view class='replier'>
                    <image src="{{users[item.openid].avatar}}"></image>
                    <text class='nickName'>{{users[item.openid].nickName}}:</text>
                    <text style='flex:1'></text>
                    <text>{{item.createdTime}}</text>
                </view>
                <view class='replyContent'>{{item.content}}</view>
                <view class="actions">
                    <image wx:if="{{myThumbups[item._id]}}" src="../images/thumbup.png" id='js-thumbup-cancel'
                           data-id="{{item._id}}" bindtap="cancelThumbup"></image>
                    <image wx:else src="../images/not-thumbup.png" id='js-thumbup' data-id="{{item._id}}"
                           bindtap="thumbup" data-reply-author="{{item.openid}}"></image>
                    <text>赞({{replyMap[item._id].thumbupCount}})</text>
                    |
                    <text>回复({{item.subordinates.length}})</text>
                </view>

                <view class='subReplies' wx:if="{{item.subReplies}}">
                    <view class='replyItem subReplyItem'
                        wx:for="{{item.subReplies}}"
                        wx:for-item="subReply"
                        wx:for-index="subIndex"
                        data-main-reply-id="{{item._id}}"
                        data-reply-id="{{subReply._id}}"
                        data-author="{{subReply.openid}}"
                        catchtap="onSubReplyClick"
                    >
                        <view class='replier'>
                            <image src="{{subReply.user.avatar}}"></image>
                            <text class='nickName'>{{users[subReply.openid].nickName}}:</text>
                            <text style='flex:1'></text>
                            <text>{{subReply.createdTime}}</text>
                        </view>
                        <view class='replyContent'>
                            <text wx:if="{{subReply.repliedOpenId}}">回复 {{users[subReply.repliedOpenId].nickName}}:</text>
                            {{subReply.content}}
                        </view>
                        <view class="actions">
                            <image wx:if="{{myThumbups[subReply._id]}}"
                                   src="../images/thumbup.png" data-id="{{subReply._id}}"
                                   bindtap="cancelThumbup"></image>
                            <image wx:else src="../images/not-thumbup.png"
                                   data-id="{{subReply._id}}" bindtap="thumbup" data-reply-author="{{subReply.openid}}"></image>
                            <text>赞({{replyMap[subReply._id].thumbupCount}})</text>
                        </view>
                        <view class='moreReplies' wx:if="{{subIndex==1}}">
                            <text>查看全部回复</text>
                            <text style="transform: rotate(90deg);font-size: 36rpx;"> > </text>
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <view class='mask' wx:if="{{expandedReply}}">
        <view class='chosenContent'>
            <view class='closeBtn' bindtap='onCloseDlg'>x</view>
            <view class='replyItem' bindtap="onExpandedMainReplyClick" data-reply-id="{{expandedReply._id}}" data-author="{{expandedReply.openid}}">
                <view class='replier'>
                    <image src="{{users[expandedReply.openid].avatar}}"></image>
                    <text class='nickName'>{{users[expandedReply.openid].nickName}}:</text>
                    <text style='flex:1'></text>
                    <text>{{expandedReply.createdTime}}</text>
                </view>
                <view class='replyContent'>{{expandedReply.content}}</view>
                <view class="actions">
                    <image wx:if="{{myThumbups[chosenReply._id]}}" src="../images/thumbup.png"
                           data-id="{{chosenReply._id}}" id='js-thumbup-cancel' bindtap="cancelThumbup"></image>
                    <image wx:else src="../images/not-thumbup.png" id='js-thumbup' data-id="{{chosenReply._id}}"
                           bindtap="thumbup" data-reply-author="{{chosenReply.openid}}"></image>
                    <text>赞({{replyMap[chosenReply._id].thumbupCount}})</text>
                    |
                    <text>回复({{chosenReply.subordinates.length}})</text>
                </view>
                <view class='subReplies' wx:if="{{expandedReply.subReplies.length}}">
                    <view
                        class='replyItem subReplyItem'
                        wx:for="{{expandedReply.subReplies}}"
                        wx:for-item="subItem"
                        wx:key="{{subItem._id}}"
                        data-reply-id="{{subItem._id}}"
                        data-author="{{subItem.openid}}"
                        data-main-reply-id="{{expandedReply._id}}"
                        catchtap="onExpandedSubReplyClick"
                    >
                        <view class='replier'>
                            <image src="{{subItem.user.avatar}}"></image>
                            <text class='nickName'>{{users[subItem.openid].nickName}}:</text>
                            <text style='flex:1'></text>
                            <text>{{subReply.createdTime}}</text>
                        </view>
                        <view class='replyContent'>
                            <text wx:if="{{subItem.repliedOpenId}}">回复 {{users[subItem.repliedOpenId].nickName}}:</text>
                            {{subItem.content}}
                        </view>
                        <view class="actions">
                            <image wx:if="{{myThumbups[subItem._id]}}" src="../images/thumbup.png"
                                   data-id="{{subItem._id}}" bindtap="cancelThumbup"></image>
                            <image wx:else src="../images/not-thumbup.png" data-id="{{subItem._id}}"
                                   bindtap="thumbup" data-reply-author="{{subItem.openid}}"></image>
                            <text>赞({{replyMap[subItem._id].thumbupCount}})</text>
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>

    <view class='commentInputWrapper'>
        <textarea
            cursor-spacing="12"
            placeholder='{{placeholder}}'
            bindinput='onInput'
            value="{{inputedComment}}"
            auto-height
            fixed
            show-confirm-bar="{{false}}"
        />
        <button size='mini' disabled="{{sendBtnDisabled}}" bindtap='onSend' loading="{{sendBtnLoading}}">发送</button>
        <button size='mini' open-type="share">
            <image src="../images/share.png" class="shareIcon"/>
            分享
        </button>
    </view>
</view>
